angular.module("JarvisApp","ngMaterial ngMdIcons ngSanitize restangular angular-websocket ui.router ui.router.router pascalprecht.translate ngCookies hljs ui.tree JarvisApp.websocket JarvisApp.config JarvisApp.theme JarvisApp.routes JarvisApp.services JarvisApp.services.filter JarvisApp.services.generic JarvisApp.services.scope JarvisApp.services.plugin JarvisApp.services.scenario JarvisApp.services.snapshot JarvisApp.services.cron JarvisApp.services.view JarvisApp.services.configuration JarvisApp.services.property JarvisApp.services.connector JarvisApp.services.device JarvisApp.services.event JarvisApp.services.trigger JarvisApp.services.block JarvisApp.directives.files JarvisApp.directives.widgets jarvis.directives.navigator jarvis.directives.command JarvisApp.ctrl.plugins JarvisApp.ctrl.devices JarvisApp.ctrl.events JarvisApp.ctrl.triggers JarvisApp.ctrl.snapshots JarvisApp.ctrl.crons JarvisApp.ctrl.views JarvisApp.ctrl.configurations JarvisApp.ctrl.properties JarvisApp.ctrl.connectors JarvisApp.ctrl.scenarios JarvisApp.ctrl.blocks JarvisApp.ctrl.home".split(" "));
"use strict";var jarvisServicesUrl="/services",jarvisApiUrl="/api",myAppServices=angular.module("JarvisApp.services",["ngResource"]);
myAppServices.factory("toastService",["$log","$mdToast",function(a,b){a=angular.injector(["ng"]).get("$log");a.info("toastService",b);var d;return d={toastPosition:{bottom:!0,top:!1,left:!1,right:!0},getToastPosition:function(){return Object.keys(d.toastPosition).filter(function(a){return d.toastPosition[a]}).join(" ")},failure:function(c){a.error(c);b.show(b.simple().content(c).position(d.getToastPosition()).hideDelay(3E3).theme("failure-toast"))},info:function(c){a.info(c,d.getToastPosition());
b.show(b.simple().position(d.getToastPosition()).textContent(c).hideDelay(3E3).capsule(!0))}}}]);myAppServices.factory("$store",["$log","$rootScope",function(a,b){a.info("$store");var d={};return{collection:d,push:function(b,e,g){void 0===d[b]&&(d[b]={});a.info("$store",b,e,g);d[b][e]=g},get:function(a,b,g){return void 0==d||void 0==d[a]||void 0==d[a][b]?g:d[a][b]}}}]);
myAppServices.factory("oauth2ResourceService",["$rootScope","$log","$window","$mdDialog","$location","Restangular",function(a,b,d,c,e,g){b=angular.injector(["ng"]).get("$log");return{me:function(a,d,c){b.info("Fix JarvisAuthToken to",a);g.setDefaultHeaders({JarvisAuthToken:a});g.one("/api/profile/me").get().then(function(a){d(a)},function(a){c(a)})},config:function(a,b,d){g.one("oauth2").get(a).then(function(a){b(a)},function(a){d(a)})},connect:function(f,d){b.info("connect with",d);var e=this;e.me(d,
function(d){b.info("profile",d);c.hide();a.profile=d;f.boot()},function(a){b.warn("no profile");e.login()})},login:function(){c.show({controller:"oauth2DialogCtrl",templateUrl:"/ui/js/partials/dialog/oauth2Dialog.tmpl.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:!1})}}}]);"use strict";myAppServices=angular.module("JarvisApp.services.filter",[]);
myAppServices.factory("filterService",["Restangular",function(a){return{plain:function(b){if(angular.isArray(b)||angular.isObject(b))b=a.stripRestangular(b),delete b.originalElement;return b}}}]);"use strict";
angular.module("JarvisApp.services.generic",["JarvisApp.services.filter"]).factory("genericResourceService",["$log","Restangular","filterService","toastService",function(a,b,d,c){var e={findAll:function(f,c,e){var g=function(b){var e=[];_.forEach(b,function(a){e.push(d.plain(a))});a.debug("[FIND]",f,e);c(e)};1==f.length?b.all("/api/"+f[0]).getList().then(g,function(a){e(a)}):b.all("/api/"+f[0]).all(f[1]).getList().then(g,function(a){e(a)})},get:function(f,c,e,g){var k=function(b){b=d.plain(b);a.debug("[GET]",
f,b);void 0!=e&&e(b)};1==f.length?b.one("/api/"+f[0],c).get().then(k,function(a){g(a)}):b.all("/api/"+f[0]).one(f[1],c).get().then(k,function(a){g(a)})},delete:function(f,c,e,g){var k=function(b){b=d.plain(b);a.debug("[DELETE]",f,b);void 0!=e&&e(b)};1==f.length?b.one("/api/"+f[0],c).remove().then(k,function(a){g(a)}):b.all("/api/"+f[0]).one(f[1],c).remove().then(k,function(a){g(a)})},put:function(f,c,e,g){var k=function(b){b=d.plain(b);a.debug("[PUT]",f,b);void 0!=e&&e(b)};1==f.length?b.one("/api/"+
f[0],c.id).customPUT(c).then(k,function(a){g(a)}):b.all("/api/"+f[0]).one(f[1],c.id).customPUT(c).then(k,function(a){g(a)})},post:function(f,c,e,g){var k=function(b){b=d.plain(b);a.debug("[POST]",f,b);void 0!=e&&e(b)};1==f.length?b.all("/api/"+f[0]).post(c).then(k,function(a){g(a)}):b.all("/api/"+f[0]).all(f[1]).post(c).then(k,function(a){g(a)})},task:function(f,c,e,g,k,l){var q=function(b){var c=d.plain(b);a.debug("[TASK]",b,f,c);void 0!=k&&k(c)};1==f.length?b.all("/api/"+f[0]).one(c).customPOST(g,
"",{task:e}).then(q,function(a){l(a)}):b.all("/api/"+f[0]).all(f[1]).one(c).customPOST(g,"",{task:e}).then(q,function(a){l(a)})}},g={findAll:function(f,c,e,g,k,l){var q=function(b){var l=[];_.forEach(b,function(a){l.push(d.plain(a))});a.debug("[FIND/L/"+e+"]",f,c,g,l);k(l)};1==c.length?1==f.length?b.one("/api/"+f[0],g).all(c[0]).getList({href:e}).then(q,function(a){l(a)}):b.all("/api/"+f[0]).one(f[1],g).all(c[0]).getList({href:e}).then(q,function(a){l(a)}):1==f.length?b.one("/api/"+f[0],g).all(c[0]).all(c[1]).getList({href:e}).then(q,
function(a){l(a)}):b.all("/api/"+f[0]).one(f[1],g).all(c[0]).all(c[1]).getList({href:e}).then(q,function(a){l(a)})},post:function(f,c,e,g,k,l,q,n){var r=function(b){b=d.plain(b);a.debug("[POST/L]",f,b);void 0!=q&&q(b)};void 0!=l&&(l.href=e);1==c.length?1==f.length?b.one("/api/"+f[0],g).one(c[0],k).customPOST(l).then(r,function(a){n(a)}):b.all("/api/"+f[0]).one(f[1],g).one(c[0],k).customPOST(l).then(r,function(a){n(a)}):1==f.length?b.one("/api/"+f[0],g).all(c[0]).one(c[1],k).customPOST(l).then(r,function(a){n(a)}):
b.all("/api/"+f[0]).one(f[1],g).all(c[0]).one(c[1],k).customPOST(l).then(r,function(a){n(a)})},put:function(c,e,g,p,k,l,q,n,r){var t=function(b){b=d.plain(b);a.debug("[PUT/L]",c,b);void 0!=n&&n(b)},s={},s=void 0===q?{}:q;s.href=g;1==e.length?1==c.length?b.one("/api/"+c[0],p).one(e[0],k).one(l).customPUT(s).then(t,function(a){r(a)}):b.all("/api/"+c[0]).one(c[1],p).one(e[0],k).one(l).customPUT(s).then(t,function(a){r(a)}):1==c.length?b.one("/api/"+c[0],p).all(e[0]).one(e[1],k).one(l).customPUT(s).then(t,
function(a){r(a)}):b.all("/api/"+c[0]).one(c[1],p).all(e[0]).one(e[1],k).one(l).customPUT(s).then(t,function(a){r(a)})},delete:function(c,e,g,p,k,l,q,n){var r=function(b){b=d.plain(b);a.debug("[DELETE/L]",c,b);void 0!=q&&q(b)};1==e.length?1==c.length?b.one("/api/"+c[0],p).one(e[0],k).remove({instance:l,href:g}).then(r,function(a){n(a)}):b.all("/api/"+c[0]).one(c[1],p).one(e[0],k).remove({instance:l,href:g}).then(r,function(a){n(a)}):1==c.length?b.one("/api/"+c[0],p).all(e[0]).one(e[1],k).remove({instance:l,
href:g}).then(r,function(a){n(a)}):b.all("/api/"+c[0]).one(c[1],p).all(e[0]).one(e[1],k).remove({instance:l,href:g}).then(r,function(a){n(a)})}};return{crud:function(a){return{findAll:function(b,c){return e.findAll(a,b,c)},get:function(b,c,d){return e.get(a,b,c,d)},delete:function(b,c,d){return e.delete(a,b,c,d)},put:function(b,c,d){return e.put(a,b,c,d)},post:function(b,c,d){return e.post(a,b,c,d)},task:function(b,c,d,g,l){return e.task(a,b,c,d,g,l)}}},links:function(a,b,c){void 0===c&&(c="HREF");
return{findAll:function(d,e,l){return g.findAll(a,b,c,d,e,l)},delete:function(d,e,l,q,n){return g.delete(a,b,c,d,e,l,q,n)},put:function(d,e,l,q,n,r){return g.put(a,b,c,d,e,l,q,n,r)},post:function(d,e,l,q,n){return g.post(a,b,c,d,e,l,q,n)}}},scope:{collections:{new:function(b,d,e,g,k){g.post(e,function(c){a.debug(b+" "+c.name+"#"+c.id+" created");d.push(c);k&&k(c)},c.failure)},findAll:function(b,d,e,g,k){a.debug("loading ",b,g);e.splice(0,e.length);g.findAll(d,function(c){_.forEach(c,function(a){e.push(a)});
a.debug("loaded ",b,e);k&&k(e)},c.failure)}},entity:{get:function(b,d,e){e.get(b,function(b){d(b);a.debug("[GET/scope] "+b.name+"#"+b.id)},c.failure)},remove:function(a,b,d,e){e.delete(d.id,function(e){c.info(b+" "+d.name+"#"+d.id+" removed");a()},c.failure)},save:function(a,b,d){d.put(b,function(d){c.info(a+" "+b.name+"#"+b.id+" updated")},c.failure)},duplicate:function(a,b,d,e){e.post(d,function(e){c.info(b+" "+d.name+"#"+d.id+" duplicated");a()},c.failure)}},link:{add:function(b,d,e,g,k){void 0!=
d&&void 0!=d.id&&""!=d.id&&g.post(b,d.id,e,function(b){a.debug("addLink",b);k.push(b)},c.failure)},save:function(b,d,e){void 0!=d&&void 0!=d.id&&""!=d.id&&e.put(b,d.id,d.instance,d.extended,function(b){a.debug("updateLink - before",d);a.debug("updateLink - after",b)},c.failure)},remove:function(b,d,e,g){void 0!=d&&void 0!=d.id&&""!=d.id&&e.delete(b,d.id,d.instance,function(b){var c=d.instance;_.remove(g,function(a){return a.instance==c});a.debug("removeLink - before",d)},c.failure)}},combo:{findAll:function(b,
d,e){a.debug("loading for select ",b,d);e.findAll(function(a){_.forEach(a,function(a){d.push({id:a.id,name:a.name})})},c.failure)}}}}}]).factory("genericPickerService",["$log","$mdDialog","toastService",function(a,b,d){return{pickers:{confirm:function(a,d,g,f){a=b.confirm().title(a).textContent(d).ariaLabel("Confirm").ok(g).cancel(f);return b.show(a)},nodes:function(a,d,g,f){b.show({controller:f,templateUrl:"js/partials/dialog/nodesDialog.tmpl.html",parent:angular.element(document.body),targetEvent:a,
clickOutsideToClose:!0}).then(function(a){d(a)},function(){g()})},graph:function(a,d,g,f,h){b.show({locals:{anchor:d},bindToController:!0,controller:h,templateUrl:"js/partials/dialog/graphDialog.tmpl.html",targetEvent:a,clickOutsideToClose:!0}).then(function(a){g(a)},function(){f()})}}}}]);"use strict";
angular.module("JarvisApp.services.scope",["JarvisApp.services.generic"]).factory("genericScopeService",["$log","$filter","genericResourceService","genericPickerService","toastService",function(a,b,d,c,e){return{scope:{resources:function(g,f,h,m,p,k){a.debug("inject default resources scope",m);h.create=function(a,b){d.scope.collections.new(m,f(),a,p,b)};h.new=function(a){d.scope.collections.new(m,f(),k,p,a)};h.crud=d.crud(m.split("/"));h.remove=function(d,e){c.pickers.confirm(b("translate")("action.drop",
{name:d.name,id:d.id}),"",b("translate")("yes"),b("translate")("no")).then(function(){a.debug("remove",d);var b=d.id;_.remove(f(),function(a){return a.id==b});h.crud.delete(d.id);e&&e(d)},function(){a.debug("abort")})};h.load=function(b){g([]);p.findAll(function(d){g(d);a.debug(m+"-ctrl",d);b&&b()},e.failure)}},resource:function(e,f,h,m,p,k,l){a.debug("inject default resource scope",f);e.remove=function(k){c.pickers.confirm(b("translate")("action.drop",{name:k.name,id:k.id}),"",b("translate")("yes"),
b("translate")("no")).then(function(){d.scope.entity.remove(function(){e.go(h)},f,k,m)},function(){a.debug("abort")})};e.save=function(a){d.scope.entity.save(f,a,m)};e.duplicate=function(a){d.scope.entity.duplicate(function(){e.go(h)},f,a,m)}},resourceLink:function(e,f,h,m,p,k,l,q,n){a.debug("inject link",k);f.add=function(b){a.debug("link::add",b);d.scope.link.add(q,b,l,k,e())};f.update=function(b){a.debug("link::update",b);d.scope.link.save(q,b,k)};f.drop=function(f){c.pickers.confirm(b("translate")("action.remove.link",
{name:f.name,id:f.id}),"",b("translate")("yes"),b("translate")("no")).then(function(){a.debug("link::drop",f);n&&n.remove?n.remove(f):d.scope.link.remove(q,f,k,e());n&&n.afterRemove&&n.afterRemove(f)},function(){a.debug("abort")})}}}}}]);"use strict";
angular.module("JarvisApp.services.plugin",[]).factory("pluginResourceService",["$log","Restangular","filterService","jarvisWidgetCommandService","genericResourceService",function(a,b,d,c,e){return{plugins:{findAll:function(a,c){var e=[],m=["scripts"],p=_.after(m.length,function(b){a(b)});_.forEach(m,function(a){b.all("plugins").all(a).getList().then(function(a){_.forEach(a,function(a){e.push(d.plain(a))});p(e)},function(a){c(a)})})}},scripts:e.crud(["plugins","scripts"]),commands:e.links(["plugins",
"scripts"],["commands"])}}]);"use strict";angular.module("JarvisApp.services.view",[]).factory("viewResourceService",["genericResourceService",function(a){return{view:a.crud(["views"]),devices:a.links(["views"],["devices"])}}]);"use strict";angular.module("JarvisApp.services.configuration",[]).factory("configurationResourceService",["genericResourceService",function(a){return{configuration:a.crud(["configurations"])}}]);"use strict";
angular.module("JarvisApp.services.property",[]).factory("propertyResourceService",["genericResourceService",function(a){return{property:a.crud(["properties"])}}]);"use strict";angular.module("JarvisApp.services.snapshot",[]).factory("snapshotResourceService",["genericResourceService",function(a){return{snapshot:a.crud(["snapshots"])}}]);"use strict";angular.module("JarvisApp.services.cron",[]).factory("cronResourceService",["genericResourceService",function(a){return{cron:a.crud(["crons"])}}]);"use strict";
angular.module("JarvisApp.services.device",[]).factory("deviceResourceService",["genericResourceService",function(a){return{device:a.crud(["devices"]),plugins:a.links(["devices"],["plugins","scripts"]),devices:a.links(["devices"],["devices"]),triggers:a.links(["devices"],["triggers"])}}]);"use strict";angular.module("JarvisApp.services.connector",[]).factory("connectorResourceService",["genericResourceService",function(a){return{connector:a.crud(["connectors"])}}]);"use strict";
angular.module("JarvisApp.services.event",[]).factory("eventResourceService",["genericResourceService",function(a){return{event:a.crud(["events"])}}]);"use strict";angular.module("JarvisApp.services.trigger",[]).factory("triggerResourceService",["genericResourceService",function(a){return{trigger:a.crud(["triggers"]),crons:a.links(["triggers"],["crons"])}}]);"use strict";
angular.module("JarvisApp.services.scenario",[]).factory("scenarioResourceService",["genericResourceService",function(a){return{scenario:a.crud(["scenarios"]),blocks:a.links(["scenarios"],["blocks"]),triggers:a.links(["scenarios"],["triggers"])}}]);"use strict";
angular.module("JarvisApp.services.block",[]).factory("blockResourceService",["$log","Restangular","genericResourceService","deviceResourceService","filterService",function(a,b,d,c,e){return{block:d.crud(["blocks"]),plugins:{"if":d.links(["blocks"],["plugins","scripts"],"HREF_IF"),then:d.links(["blocks"],["plugins","scripts"],"HREF_THEN"),"else":d.links(["blocks"],["plugins","scripts"],"HREF_ELSE")},blocks:{then:d.links(["blocks"],["blocks"],"HREF_THEN"),"else":d.links(["blocks"],["blocks"],"HREF_ELSE")}}}]);
"use strict";
angular.module("JarvisApp.config",["JarvisApp.directives.files"]).config(["RestangularProvider",function(a){a.setDefaultHeaders({"content-type":"application/json"});a.setFullRequestInterceptor(function(a,d,c,e,g,f,h){return{element:a,params:f,headers:g,httpConfig:h}});a.setResponseExtractor(function(a){angular.isObject(a)&&(a.originalElement=a);return a})}]).config(["$mdIconProvider",function(a){}]).config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"js/l10n/",suffix:".json"});a.preferredLanguage("fr_FR");
a.useSanitizeValueStrategy(null)}]).controller("JarvisAppCtrl",["$rootScope","$scope","$log","$store","$notification","$http","$mdDialog","$mdSidenav","$mdMedia","$location","$window","$state","genericPickerService","toastService","deviceResourceService","eventResourceService","configurationResourceService","oauth2ResourceService",function(a,b,d,c,e,g,f,h,m,p,k,l,q,n,r,t,s,u){b.isJson=function(a){try{JSON.parse(a)}catch(b){return!1}return!0};b.defaultValue=function(a,b){return void 0===a?b:a};b.loadSettings=
function(){s.configuration.findAll(function(a){(a=_.find(a,"active"))?b.config=a:n.failure("No default settings")},n.failure)};b.saveSettings=function(){s.configuration.put(b.config,function(a){d.info("Updated",a)},n.failure)};b.closeSettings=function(){f.hide()};b.settings=function(a){var c=m("sm")||m("xs");f.show({scope:b,preserveScope:!0,templateUrl:"js/partials/dialog/settingsDialog.tmpl.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,fullscreen:c}).then(function(){d.warn("Saving settings")},
function(){d.warn("Cancel settings save")})};b.markdown=new showdown.Converter({tables:"true",ghCodeBlocks:"true"});b.helper=function(a){d.debug("State",l.current.name);g.get("js/helps/fr/"+l.current.name+".markdown").then(function(a){a=b.markdown.makeHtml(a.data);b.help={content:a.replace(/<table>/g,'\x3ctable class\x3d"table table-striped table-bordered table-hover"\x3e')};d.debug("Help",b.help);h("right").toggle()})};b.toggleSidenav=function(a){h(a).toggle()};b.location=function(a,b){h(a).toggle();
p.path(b)};b.go=function(a,b){l.go(a,b)};b.emit=function(a,b){d.debug("JarvisAppCtrl::emit",a,b,a.trigger);t.event.post({trigger:a.trigger,timestamp:(new Date).toISOString(),fired:!0,number:b},function(a){d.debug("JarvisAppCtrl::emit",a);n.info("event "+a.trigger+"#"+a.id+" emitted")},n.failure)};b.execute=function(a){r.device.task(a.id,"execute",{},function(a){d.debug("JarvisAppCtrl::execute",a);b.renderdata=a},n.failure)};b.graph=function(a,b){return q.pickers.graph(a,b,function(a){d.debug("Go")},
function(){d.debug("Abort")},"graphDialogCtrl")};b.$watch(function(a,b,d){return c.collection},function(a,d,c){b.store=a});b.boot=function(){b.config={};b.version={angular:angular.version,angularmd:window.ngMaterial};d.info("JarvisAppCtrl",b.version);b.media=m("xs");b.$watch(function(){return m("xs")},function(a){a&&(b.media="xs")});b.$watch(function(){return m("gt-xs")},function(a){a&&(b.media="gt-xs")});b.$watch(function(){return m("sm")},function(a){a&&(b.media="sm")});b.$watch(function(){return m("gt-sm")},
function(a){a&&(b.media="gt-sm")});b.$watch(function(){return m("md")},function(a){a&&(b.media="md")});b.$watch(function(){return m("gt-md")},function(a){a&&(b.media="gt-md")});b.$watch(function(){return m("lg")},function(a){a&&(b.media="lg")});b.$watch(function(){return m("gt-lg")},function(a){a&&(b.media="gt-lg")});b.$watch(function(){return m("xl")},function(a){a&&(b.media="xl")});b.$watch(function(){return m("print")},function(a){a&&(b.media="print")});hljs.initHighlightingOnLoad();b.loadSettings();
d.info("JarvisAppCtrl configured")};u.connect(b)}]).controller("extractTokenCtrl",["$scope","$log","$location","$rootScope","$state","oauth2ResourceService",function(a,b,d,c,e,g){b.warn("extractTokenCtrl",e);b=d.path().substr(1).split("\x26");c={};for(e=0;e<b.length;e++){var f=b[e].split("\x3d"),h=f[0];c[h]=f[1];"access_token"===h&&(g.connect(a,c.access_token),d.path("/home"))}}]).controller("oauth2DialogCtrl",["$scope","$window","$log","$mdDialog","oauth2ResourceService",function(a,b,d,c,e){a.hide=
function(){c.hide()};a.cancel=function(){c.cancel()};a.answer=function(a){e.config({client:a.client,oauth2_redirect_uri:b.location.href.split("#")[0]},function(a){d.info("JarvisAppCtrl configured with",a);b.location.href=a.url},function(a){d.warn("no oauth2 configuration",a)});c.hide()}}]).controller("graphDialogCtrl",["$scope","$log","$mdDialog",function(a,b,d){b.info("graphDialogCtrl");a.hide=function(){d.hide()};a.cancel=function(){d.cancel()};a.answer=function(a){d.hide(a)}}]).controller("pickPluginDialogCtrl",
["$scope","$log","$mdDialog","genericResourceService","toastService",function(a,b,d,c,e){b.info("pickPluginDialogCtrl");a.hide=function(){d.hide()};a.cancel=function(){d.cancel()};a.answer=function(a){d.hide(a)};a.elementsPicker=[{name:"Connected Objects",selectable:!1,nodes:[]},{name:"Plugin Scripts",selectable:!1,nodes:[]}];a.crudDevice=c.crud(["devices"]);a.crudDevice.findAll(function(b){_.each(b,function(b){b.selectable=!1;a.elementsPicker[0].nodes.push(b)})},e.failure);a.crudScript=c.crud(["plugins",
"scripts"]);a.crudScript.findAll(function(b){_.each(b,function(b){b.selectable=!0;a.elementsPicker[1].nodes.push(b)})},e.failure)}]).controller("pickDeviceDialogCtrl",["$scope","$log","$mdDialog","genericResourceService","toastService",function(a,b,d,c,e){b.info("pickDeviceDialogCtrl");a.hide=function(){d.hide()};a.cancel=function(){d.cancel()};a.answer=function(a){d.hide(a)};a.elementsPicker=[{name:"Connected Objects",selectable:!1,nodes:[]},{name:"Plugin Scripts",selectable:!1,nodes:[]}];a.crudDevice=
c.crud(["devices"]);a.crudDevice.findAll(function(b){_.each(b,function(b){b.selectable=!0;a.elementsPicker[0].nodes.push(b)})},e.failure);a.crudScript=c.crud(["plugins","scripts"]);a.crudScript.findAll(function(b){_.each(b,function(b){b.selectable=!1;a.elementsPicker[1].nodes.push(b)})},e.failure)}]).controller("pickCommandDialogCtrl",["$scope","$log","$mdDialog","genericResourceService","toastService",function(a,b,d,c,e){b.info("pickCommandDialogCtrl");a.hide=function(){d.hide()};a.cancel=function(){d.cancel()};
a.answer=function(a){d.hide(a)};a.elementsPicker=[{name:"Commands",selectable:!1,nodes:[]}];a.crud=c.crud(["commands"]);a.crud.findAll(function(b){_.each(b,function(b){b.selectable=!0;a.elementsPicker[0].nodes.push(b)})},e.failure)}]).controller("pickTriggerDialogCtrl",["$scope","$log","$mdDialog","genericResourceService","toastService",function(a,b,d,c,e){b.info("pickTriggerDialogCtrl");a.hide=function(){d.hide()};a.cancel=function(){d.cancel()};a.answer=function(a){d.hide(a)};a.elementsPicker=[{name:"Triggers",
selectable:!1,nodes:[]}];a.crud=c.crud(["triggers"]);a.crud.findAll(function(b){_.each(b,function(b){b.selectable=!0;a.elementsPicker[0].nodes.push(b)})},e.failure)}]).controller("pickCronDialogCtrl",["$scope","$log","$mdDialog","genericResourceService","toastService",function(a,b,d,c,e){b.info("pickCronDialogCtrl");a.hide=function(){d.hide()};a.cancel=function(){d.cancel()};a.answer=function(a){d.hide(a)};a.elementsPicker=[{name:"Crontab objects",selectable:!1,nodes:[]}];a.crud=c.crud(["crons"]);
a.crud.findAll(function(b){_.each(b,function(b){b.selectable=!0;a.elementsPicker[0].nodes.push(b)})},e.failure)}]).controller("pickBlockDialogCtrl",["$scope","$log","$mdDialog","genericResourceService","toastService",function(a,b,d,c,e){b.info("pickBlockDialogCtrl");a.hide=function(){d.hide()};a.cancel=function(){d.cancel()};a.answer=function(a){d.hide(a)};a.elementsPicker=[{name:"Blocks",selectable:!1,nodes:[]}];a.crudBlock=c.crud(["blocks"]);a.crudBlock.findAll(function(b){_.each(b,function(b){b.selectable=
!0;a.elementsPicker[0].nodes.push(b)})},e.failure)}]);"use strict";
angular.module("JarvisApp.theme",["ngMaterial"]).config(["$mdThemingProvider",function(a){a.alwaysWatchTheme(!0);a.definePalette("customPrimary",{50:"#aaeafd",100:"#92e4fc",200:"#79defc",300:"#60d8fb",400:"#47d2fb",500:"#2ECCFA",600:"#15c6f9",700:"#06bbef",800:"#05a7d6",900:"#0594bd",A100:"#c3f0fe",A200:"#dcf7fe",A400:"#f5fdff",A700:"#0480a5"});a.definePalette("customAccent",{50:"#ffffff",100:"#ffffff",200:"#ffffff",300:"#f8fcfe",400:"#e3f4f9",500:"#CEECF5",600:"#b9e4f1",700:"#a4dcec",800:"#8ed3e8",
900:"#79cbe4",A100:"#ffffff",A200:"#ffffff",A400:"#ffffff",A700:"#64c3df"});a.definePalette("customWarn",{50:"#ff8080",100:"#ff6666",200:"#ff4d4d",300:"#ff3333",400:"#ff1a1a",500:"#FF0000",600:"#e60000",700:"#cc0000",800:"#b30000",900:"#990000",A100:"#ff9999",A200:"#ffb3b3",A400:"#ffcccc",A700:"#800000"});a.definePalette("customBackground",{50:"#ffffff",100:"#ffffff",200:"#ffffff",300:"#ffffff",400:"#ffffff",500:"#F2F2F2",600:"#e5e5e5",700:"#d8d8d8",800:"#cccccc",900:"#bfbfbf",A100:"#ffffff",A200:"#ffffff",
A400:"#ffffff",A700:"#b2b2b2"});a.theme("default").primaryPalette("customPrimary").accentPalette("customAccent").warnPalette("customWarn").backgroundPalette("customBackground")}]);"use strict";
angular.module("JarvisApp.websocket",["angular-websocket"]).factory("$notification",["$store","$log","$websocket","$window",function(a,b,d,c){b.info("$notification",c.location);b=d("ws://"+c.location.hostname+":"+c.location.port+"/stream/");b.onMessage(function(b){b=JSON.parse(b.data);a.push(b.classname,b.instance,b.data)});return{dataStream:b}}]);"use strict";
angular.module("JarvisApp.routes",["JarvisApp.config"]).config(["$urlRouterProvider",function(a){a.otherwise("/home")}]).config(["$stateProvider",function(a){a.state("token_access",{url:"/access_token\x3d:accesToken",controller:"extractTokenCtrl",template:""}).state("home",{url:"/home",controller:"homeCtrl",templateUrl:"/ui/js/partials/home/page.html"}).state("helper-devices",{url:"/helper-devices",params:{resources:["crons","triggers","devices","plugins","commands"]},controller:"jarvisWidgetNavigatorCtrl",
templateUrl:"/ui/js/directives/navigator/jarvis-widget-navigator.html"}).state("helper-scenarii",{url:"/helper-scenarii",params:{resources:["triggers","crons","scenarios","blocks","plugins"]},controller:"jarvisWidgetNavigatorCtrl",templateUrl:"/ui/js/directives/navigator/jarvis-widget-navigator.html"}).state("helper-system",{url:"/helper-system",params:{resources:["configurations","properties","connectors","views"]},controller:"jarvisWidgetNavigatorCtrl",templateUrl:"/ui/js/directives/navigator/jarvis-widget-navigator.html"}).state("events",
{url:"/events",controller:"eventsCtrl",templateUrl:"/ui/js/partials/events/page.html"}).state("triggers",{url:"/triggers",controller:"triggersCtrl",templateUrl:"/ui/js/partials/triggers/page.html"}).state("triggers-by-id",{url:"/triggers/:id?tab",controller:"triggerCtrl",templateUrl:"/ui/js/partials/triggers/trigger/page.html"}).state("devices",{url:"/devices",controller:"devicesCtrl",templateUrl:"/ui/js/partials/devices/page.html"}).state("devices-by-id",{url:"/devices/:id?tab",controller:"deviceCtrl",
templateUrl:"/ui/js/partials/devices/device/page.html"}).state("plugins",{url:"/plugins",controller:"pluginsCtrl",templateUrl:"/ui/js/partials/plugins/page.html"}).state("plugins-by-id-script",{url:"/plugins/scripts/:id?tab",controller:"pluginScriptCtrl",templateUrl:"/ui/js/partials/plugins/script/page.html"}).state("commands",{url:"/commands",controller:"commandsCtrl",template:"\x3cjarvis-widget-commands\x3e\x3c/jarvis-widget-commands\x3e"}).state("commands-by-id",{url:"/commands/:id",controller:"commandCtrl",
template:"\x3cjarvis-widget-command\x3e\x3c/jarvis-widget-command\x3e"}).state("views",{url:"/views",controller:"viewsCtrl",templateUrl:"/ui/js/partials/views/page.html"}).state("views-by-id",{url:"/views/:id",controller:"viewCtrl",templateUrl:"/ui/js/partials/views/view/page.html"}).state("configurations",{url:"/configurations",controller:"configurationsCtrl",templateUrl:"/ui/js/partials/configurations/page.html"}).state("configurations-by-id",{url:"/configurations/:id",controller:"configurationCtrl",
templateUrl:"/ui/js/partials/configurations/configuration/page.html"}).state("properties",{url:"/properties",controller:"propertiesCtrl",templateUrl:"/ui/js/partials/properties/page.html"}).state("properties-by-id",{url:"/properties/:id",controller:"propertyCtrl",templateUrl:"/ui/js/partials/properties/property/page.html"}).state("connectors",{url:"/connectors",controller:"connectorsCtrl",templateUrl:"/ui/js/partials/connectors/page.html"}).state("connectors-by-id",{url:"/connectors/:id",controller:"connectorCtrl",
templateUrl:"/ui/js/partials/connectors/connector/page.html"}).state("snapshots",{url:"/snapshots",controller:"snapshotsCtrl",templateUrl:"/ui/js/partials/snapshots/page.html"}).state("snapshots-by-id",{url:"/snapshots/:id",controller:"snapshotCtrl",templateUrl:"/ui/js/partials/snapshots/snapshot/page.html"}).state("crons",{url:"/crons",controller:"cronsCtrl",templateUrl:"/ui/js/partials/crons/page.html"}).state("crons-by-id",{url:"/crons/:id",controller:"cronCtrl",templateUrl:"/ui/js/partials/crons/cron/page.html"}).state("scenarios",
{url:"/scenarios",controller:"scenariosCtrl",templateUrl:"/ui/js/partials/scenarios/page.html"}).state("scenarios-by-id",{url:"/scenarios/:id?tab",controller:"scenarioCtrl",templateUrl:"/ui/js/partials/scenarios/scenario/page.html"}).state("blocks",{url:"/blocks",controller:"blocksCtrl",templateUrl:"/ui/js/partials/blocks/page.html"}).state("blocks-by-id",{url:"/blocks/:id?tab",controller:"blockCtrl",templateUrl:"/ui/js/partials/blocks/block/page.html"})}]);"use strict";
angular.module("JarvisApp.directives.files",[]).directive("appVersion",function(a){return function(b,d,c){d.text(a)}}).directive("fileModel",["$parse","$log",function(a,b){return{restrict:"A",link:function(b,c,e){var g=a(e.fileModel).assign;c.bind("change",function(){b.$apply(function(){g(b,c[0].files[0])})})}}}]).directive("fileSelect",["$window","$log",function(a,b){return{restrict:"A",require:"ngModel",link:function(d,c,e,g){var f=new a.FileReader;f.onload=function(){b.info("fileSelect.onload");
var a=f.result.substr(f.result.lastIndexOf(",")+1);b.debug("result:",f.result);b.debug("result base64 value:",a);g.$setViewValue(atob(a));"fileLoaded"in e&&d.$eval(e.fileLoaded)};f.onprogress=function(a){"fileProgress"in e&&d.$eval(e.fileProgress,{$total:a.total,$loaded:a.loaded})};f.onerror=function(){"fileError"in e&&d.$eval(e.fileError,{$error:f.error})};var h=e.fileSelect;c.bind("change",function(a){b.info("fileSelect.change");a=a.target.files[0];""===h||"text"===h?f.readAsText(a,"UTF-8"):"data"===
h&&f.readAsDataURL(a)})}}}]);"use strict";angular.module("JarvisApp.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/mg,a)}}]);"use strict";
angular.module("JarvisApp.directives.widgets",["JarvisApp.services"]).directive("jarvisPlugins",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/plugins/jarvis-plugins.html",link:function(b,c,e){a.debug("jarvis-plugins")}}}]).directive("jarvisDefaultMenuBar",["$log","$parse",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/widget/tools/jarvis-default-menu-bar.html",require:"ngModel",link:function(a,b,e,g){a.closeMenu=e.close;a.element=function(){return g.$viewValue}}}}]).directive("jarvisPickElement",
["$log","$parse","genericPickerService",function(a,b,d){return{restrict:"E",template:'\x3cmd-button aria-label\x3d"menu" class\x3d"md-icon-button" ng-click\x3d"pickItemDialog($event)"\x3e\x3cmd-tooltip\x3e{{pick.tooltips|translate}}\x3c/md-tooltip\x3e\x3cmd-icon md-font-icon\x3d"material-icons md-16"\x3e{{pick.icon}}\x3c/md-icon\x3e\x3c/md-button\x3e',scope:{},link:function(c,e,g,f){c.pick={};c.pick.tooltips=g.tooltips;c.pick.icon=g.icon;c.pick.tooltips=g.tooltips;c.pick.ctrl=g.ctrl;c.pick.callback=
g.callback;c.pickItemDialog=function(e,f){return d.pickers.nodes(e,function(a){b(c.pick.callback)(c.$parent)(a)},function(){a.debug("no picked element")},c.pick.ctrl)}}}}]).directive("jarvisPluginCommon",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/plugins/script/jarvis-plugin-general.html",link:function(b,c,e){a.debug("jarvis-plugin-common")}}}]).directive("jarvisPluginScript",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/plugins/script/jarvis-plugin-script.html",
link:function(b,c,e){a.debug("jarvis-plugin-script")}}}]).directive("typecommand",["$log",function(a){return{require:"ngModel",link:function(a,d,c,e){e.$validators.typecommand=function(a,b){return e.$isEmpty(a)?!1:"data"==a||"action"==a?!0:!1}}}}]).directive("naturecommand",["$log",function(a){return{require:"ngModel",link:function(a,d,c,e){e.$validators.naturecommand=function(a,b){return e.$isEmpty(a)?!1:"text"==a||"json"==a||"xml"==a?!0:!1}}}}]).directive("jarvisPluginRender",["$log","$stateParams",
function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/plugins/script/jarvis-plugin-result.html",link:function(b,c,e){a.debug("jarvis-plugin-output")}}}]).directive("jarvisDevices",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/devices/jarvis-devices.html",link:function(b,c,e){a.debug("jarvis-devices")}}}]).directive("jarvisDevice",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/devices/device/jarvis-device-general.html",
link:function(b,c,e){a.debug("jarvis-device-general")}}}]).directive("jarvisDevicePlugin",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/devices/device/jarvis-device-plugin.html",link:function(b,c,e){a.debug("jarvis-device-plugin")}}}]).directive("jarvisDeviceRender",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/devices/device/jarvis-device-render.html",link:function(b,c,e){a.debug("jarvis-device-render")}}}]).directive("jarvisEvents",
["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/events/jarvis-events.html",link:function(b,c,e){a.debug("jarvis-devices")}}}]).directive("jarvisTriggers",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/triggers/jarvis-triggers.html",link:function(b,c,e){a.debug("jarvis-triggers")}}}]).directive("jarvisTrigger",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/triggers/trigger/jarvis-trigger-general.html",
link:function(b,c,e){a.debug("jarvis-trigger")}}}]).directive("jarvisTriggerCron",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/triggers/trigger/jarvis-trigger-cron.html",link:function(b,c,e){a.debug("jarvis-trigger-cron")}}}]).directive("jarvisViews",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/views/jarvis-views.html",link:function(b,c,e){a.debug("jarvis-views")}}}]).directive("jarvisView",["$log","$stateParams",function(a,
b){return{restrict:"E",templateUrl:"/ui/js/partials/views/view/jarvis-view-general.html",link:function(b,c,e){a.debug("jarvis-view")}}}]).directive("jarvisConfigurations",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/configurations/jarvis-configurations.html",link:function(b,c,e){a.debug("jarvis-configurations")}}}]).directive("jarvisConfiguration",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/configurations/configuration/jarvis-configuration-general.html",
link:function(b,c,e){a.debug("jarvis-configuration")}}}]).directive("jarvisProperties",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/properties/jarvis-properties.html",link:function(b,c,e){a.debug("jarvis-properties")}}}]).directive("jarvisProperty",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/properties/property/jarvis-property-general.html",link:function(b,c,e){a.debug("jarvis-property")}}}]).directive("jarvisConnectors",
["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/connectors/jarvis-connectors.html",link:function(b,c,e){a.debug("jarvis-connectors")}}}]).directive("jarvisConnectorGeneral",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/connectors/connector/jarvis-connector-general.html",link:function(b,c,e){a.debug("jarvis-connector-general")}}}]).directive("jarvisSnapshots",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/snapshots/jarvis-snapshots.html",
link:function(b,c,e){a.debug("jarvis-snapshots")}}}]).directive("jarvisSnapshot",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/snapshots/snapshot/jarvis-snapshot-general.html",link:function(b,c,e){a.debug("jarvis-snapshot")}}}]).directive("jarvisCrons",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/crons/jarvis-crons.html",link:function(b,c,e){a.debug("jarvis-crons")}}}]).directive("jarvisCron",["$log","$stateParams",function(a,
b){return{restrict:"E",templateUrl:"/ui/js/partials/crons/cron/jarvis-cron-general.html",link:function(b,c,e){a.debug("jarvis-cron")}}}]).directive("jarvisScenarios",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/scenarios/jarvis-scenarios.html",link:function(b,c,e){a.debug("jarvis-scenarios")}}}]).directive("jarvisScenario",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/scenarios/scenario/jarvis-scenario-general.html",
link:function(b,c,e){a.debug("jarvis-scenario")}}}]).directive("jarvisScenarioBlocks",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/scenarios/scenario/jarvis-scenario-blocks.html",link:function(b,c,e){a.debug("jarvis-scenario-blocks")}}}]).directive("jarvisScenarioBlock",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/scenarios/scenario/jarvis-scenario-block.html",link:function(b,c,e){a.debug("jarvis-scenario-block")}}}]).directive("jarvisScenarioGraph",
["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/scenarios/scenario/jarvis-scenario-graph.html",link:function(b,c,e){a.debug("jarvis-scenario-graph")}}}]).directive("jarvisScenarioConsole",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/scenarios/scenario/jarvis-scenario-console.html",link:function(b,c,e){a.debug("jarvis-scenario-console")}}}]).directive("jarvisBlocks",["$log","$stateParams",function(a,b){return{restrict:"E",
templateUrl:"/ui/js/partials/blocks/jarvis-blocks.html",link:function(b,c,e){a.debug("jarvis-blocks")}}}]).directive("jarvisBlock",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/blocks/block/jarvis-block-general.html",link:function(b,c,e){a.debug("jarvis-block")}}}]).directive("jarvisBlockThen",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/blocks/block/jarvis-block-then.html",link:function(b,c,e){a.debug("jarvis-block-then")}}}]).directive("jarvisBlockElse",
["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/blocks/block/jarvis-block-else.html",link:function(b,c,e){a.debug("jarvis-block-else")}}}]).directive("jarvisHome",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/home/jarvis-home.html",link:function(b,c,e){a.debug("jarvis-home")}}}]).directive("jarvisCard",["$log","$parse",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/widget/tile/jarvis-card.html",scope:!1,
link:function(d,c,e){a.debug("jarvis-card element",b(e.element)(d));a.debug("jarvis-card state",b(e.state)(d));d.element=b(e.element)(d);d.state=b(e.state)(d)}}}]).directive("jarvisTile",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/widget/tile/jarvis-tile.html",link:function(b,c,e){a.debug("jarvis-tile")}}}]).directive("jarvisTileBoolean",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/widget/tile/jarvis-tile-boolean.html",
link:function(b,c,e){a.debug("jarvis-tile-boolean")}}}]).directive("jarvisTileInt",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/widget/tile/jarvis-tile-int.html",link:function(b,c,e){a.debug("jarvis-tile-int")}}}]).directive("jarvisTilePercent",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/partials/widget/tile/jarvis-tile-percent.html",link:function(b,c,e){a.debug("jarvis-tile-percent")}}}]).directive("jarvisInlineTemplate",["$log",
"$stateParams","$parse",function(a,b,d){return{restrict:"E",template:'\x3cdiv ng-include\x3d"getJarvisInlineTemplateUrl()"\x3e\x3c/div\x3e',link:function(b,e,g){a.debug("jarvis-inline-template id",d(g.id)(b));b.getJarvisInlineTemplateUrl=function(){b.data=d(g.data)(b);return"/api/directives/html/devices/"+d(g.id)(b)}}}}]).directive("jarvisGauge",["$log","$store","$notification",function(a,b,d){return{restrict:"AC",controller:["$scope","$element","$attrs",function(c,d,g){a.debug("jarvis-gauge",g.id);
c.gauge=(new Gauge(document.getElementById(g.id))).setOptions({fontSize:10,lines:10,angle:0,lineWidth:.32,pointer:{length:.9,strokeWidth:.035,color:"#000000"},limitMax:"false",colorStart:"#6FADCF",colorStop:"#8FC0DA",strokeColor:"#E0E0E0",generateGradient:!0});c.gauge.maxValue=100;c.gauge.animationSpeed=10;c.gauge.set(0);c.$watch(function(){return 100*b.get("SystemIndicator","1",0).systemCpuLoad},function(a,b,d){c.gauge.set(a)})}]}}]);
angular.module("jarvis.directives.command",["JarvisApp.services"]).controller("commandsCtrl",["$scope","$log","genericScopeService","jarvisWidgetCommandService",function(a,b,d,c){d.scope.resources(function(b){a.commands=b},function(){return a.commands},a,"commands",c.command,{name:"command name",icon:"list"})}]).controller("commandCtrl",["$scope","$log","$stateParams","genericResourceService","genericScopeService","jarvisWidgetCommandService","toastService",function(a,b,d,c,e,g,f){e.scope.resource(a,
"command","commands",g.command);a.execute=function(b){g.command.task(b.id,"execute",a.rawTestData,function(c){f.info("command "+b.name+"#"+b.id+" executed");a.output=angular.toJson(c,!0)},f.failure)};a.test=function(b){g.command.task(b.id,"test",a.rawTestData,function(c){f.info("command "+b.name+"#"+b.id+" tested");a.output=angular.toJson(c,!0)},f.failure)};a.pretty=function(){b.debug("pretty",a.rawinput);a.jsonTestData=angular.toJson(a.rawTestData,!0)};a.submit=function(){a.rawTestData=angular.fromJson(a.editTestData);
a.jsonTestData=angular.toJson(a.rawTestData,!0)};a.clear=function(){a.rawTestData={"default":"todo"};a.editTestData=angular.toJson(a.rawTestData,!0);a.jsonTestData=angular.toJson(a.rawTestData,!0);a.rawoutput={};a.output=angular.toJson({},!0)};a.load=function(){a.combo={visibles:g.bool,types:g.types};a.clear();a.commands=[];c.scope.entity.get(d.id,function(b){a.command=b},g.command);b.info("command-ctrl")}}]).factory("jarvisWidgetCommandService",["genericResourceService",function(a){return{command:a.crud(["commands"]),
bool:[{id:!0,value:"common.true"},{id:!1,value:"common.false"}],types:[{id:"SHELL",value:"command.shell"},{id:"COMMAND",value:"command.single"},{id:"GROOVY",value:"command.groovy"},{id:"SSH",value:"command.ssh"},{id:"ZWAY",value:"command.zway"}]}}]).directive("jarvisWidgetCommands",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/directives/command/jarvis-widget-commands.html",link:function(a,b,e){}}}]).directive("jarvisCommands",["$log","$stateParams",function(a,b){return{restrict:"E",
templateUrl:"/ui/js/directives/command/partials/jarvis-commands.html",link:function(a,b,e){}}}]).directive("jarvisWidgetCommand",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/directives/command/jarvis-widget-command.html",link:function(a,b,e){}}}]).directive("jarvisCommand",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/directives/command/partials/jarvis-command-general.html",link:function(b,c,e){a.debug("jarvis-command")}}}]).directive("jarvisCommandInput",
["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/directives/command/partials/jarvis-command-input.html",link:function(b,c,e){a.debug("jarvis-command-input")}}}]).directive("jarvisCommandScript",["$log","$stateParams",function(a,b){return{restrict:"E",templateUrl:"/ui/js/directives/command/partials/jarvis-command-script.html",link:function(b,c,e){a.debug("jarvis-command-script")}}}]).directive("jarvisCommandOutput",["$log","$stateParams",function(a,b){return{restrict:"E",
templateUrl:"/ui/js/directives/command/partials/jarvis-command-output.html",link:function(b,c,e){a.debug("jarvis-command-output")}}}]);
angular.module("jarvis.directives.navigator",["JarvisApp.services"]).controller("jarvisWidgetNavigatorCtrl",["$scope","$log","$stateParams",function(a,b,d){a.resources=d.resources;a.answer=function(a){a.callback(a)}}]).factory("jarvisWidgetNavigatorService",["$q","$location","snapshotResourceService","blockResourceService","configurationResourceService","propertyResourceService","viewResourceService","triggerResourceService","scenarioResourceService","cronResourceService","connectorResourceService",
"jarvisWidgetCommandService","pluginResourceService","deviceResourceService",function(a,b,d,c,e,g,f,h,m,p,k,l,q,n){return{devices:function(){var c=a.defer();n.device.findAll(function(a){_.each(a,function(a){n.plugins.findAll(a.id,function(b){a.desc="";_.each(b,function(b){a.desc+=b.name})});a.selectable=!0;a.callback=function(a){b.path("/devices/"+a.id)};a.ext=angular.toJson(angular.fromJson(a.parameters),!0)});c.resolve({elements:a,title:"Devices",route:"/devices"})});return c.promise},plugins:function(){var c=
a.defer();q.scripts.findAll(function(a){_.each(a,function(a){q.commands.findAll(a.id,function(b){a.desc="";_.each(b,function(b){a.desc+=b.name})});a.selectable=!0;a.callback=function(a){b.path("/plugins/scripts/"+a.id)}});c.resolve({elements:a,title:"Plugins",route:"/plugins"})});return c.promise},commands:function(){var c=a.defer();l.command.findAll(function(a){_.each(a,function(a){a.ext=a.body;a.selectable=!0;a.callback=function(a){b.path("/commands/"+a.id)}});c.resolve({elements:a,title:"Commands",
route:"/commands"})});return c.promise},snapshots:function(){var c=a.defer();d.snapshot.findAll(function(a){_.each(a,function(a){a.selectable=!0;a.callback=function(a){b.path("/snapshots/"+a.id)}});c.resolve({elements:a,title:"Snapshots",route:"/snapshots"})});return c.promise},blocks:function(){var d=a.defer();c.block.findAll(function(a){_.each(a,function(a){a.selectable=!0;a.callback=function(a){b.path("/blocks/"+a.id)}});d.resolve({elements:a,title:"Blocks",route:"/blocks"})});return d.promise},
configurations:function(){var c=a.defer();e.configuration.findAll(function(a){_.each(a,function(a){a.selectable=!0;a.callback=function(a){b.path("/configurations/"+a.id)}});c.resolve({elements:a,title:"Configurations",route:"/configurations"})});return c.promise},properties:function(){var c=a.defer();g.property.findAll(function(a){_.each(a,function(a){a.selectable=!0;a.callback=function(a){b.path("/properties/"+a.id)}});c.resolve({elements:a,title:"Properties",route:"/properties"})});return c.promise},
views:function(){var c=a.defer();f.view.findAll(function(a){_.each(a,function(a){a.selectable=!0;a.callback=function(a){b.path("/views/"+a.id)}});c.resolve({elements:a,title:"Views",route:"/views"})});return c.promise},triggers:function(){var c=a.defer();h.trigger.findAll(function(a){_.each(a,function(a){a.selectable=!0;a.callback=function(a){b.path("/triggers/"+a.id)}});c.resolve({elements:a,title:"Triggers",route:"/triggers"})});return c.promise},scenarios:function(){var c=a.defer();m.scenario.findAll(function(a){_.each(a,
function(a){a.selectable=!0;a.callback=function(a){b.path("/scenarios/"+a.id)}});c.resolve({elements:a,title:"Scenarios",route:"/scenarios"})});return c.promise},crons:function(){var c=a.defer();p.cron.findAll(function(a){_.each(a,function(a){a.selectable=!0;a.callback=function(a){b.path("/crons/"+a.id)}});c.resolve({elements:a,title:"Crontab",route:"/crons"})});return c.promise},connectors:function(){var c=a.defer();k.connector.findAll(function(a){_.each(a,function(a){a.selectable=!0;a.callback=
function(a){b.path("/connectors/"+a.id)}});c.resolve({elements:a,title:"Connectors",route:"/connectors"})});return c.promise}}}]).directive("jarvisWidgetNavigator",["$log","$location","$stateParams","jarvisWidgetNavigatorService",function(a,b,d,c){return{restrict:"E",templateUrl:"/ui/js/directives/navigator/partials/jarvis-navigator.html",link:function(a,d,f){a.elements=[];d=null;"devices"===f.resource&&(d=c.devices());"plugins"===f.resource&&(d=c.plugins());"commands"===f.resource&&(d=c.commands());
"snapshots"===f.resource&&(d=c.snapshots());"blocks"===f.resource&&(d=c.blocks());"configurations"===f.resource&&(d=c.configurations());"properties"===f.resource&&(d=c.properties());"views"===f.resource&&(d=c.views());"triggers"===f.resource&&(d=c.triggers());"scenarios"===f.resource&&(d=c.scenarios());"crons"===f.resource&&(d=c.crons());"connectors"===f.resource&&(d=c.connectors());null!=d&&d.then(function(c){a.elements.push({name:c.title,selectable:!0,callback:function(a){b.path(c.route)},nodes:c.elements})})}}}]);
"use strict";
angular.module("JarvisApp.ctrl.blocks",["JarvisApp.services"]).controller("blocksCtrl",["$scope","$log","genericScopeService","genericPickerService","blockResourceService","toastService",function(a,b,d,c,e,g){d.scope.resources(function(b){a.blocks=b},function(){return a.blocks},a,"blocks",e.block,{name:"block name",icon:"list",parameter:"{}"})}]).controller("blockCtrl",["$scope","$log","$stateParams","genericScopeService","genericResourceService","genericPickerService","blockResourceService","toastService",
function(a,b,d,c,e,g,f,h){c.scope.resource(a,"block","blocks",f.block);a.links={plugins:{"if":{},then:{},"else":{}},blocks:{then:{},"else":{}}};c.scope.resourceLink(function(){return a.plugins.if},a.links.plugins.if,"block","blocks",f.block,f.plugins.if,{order:"1"},d.id);c.scope.resourceLink(function(){return a.plugins.then},a.links.plugins.then,"block","blocks",f.block,f.plugins.then,{order:"1"},d.id);c.scope.resourceLink(function(){return a.plugins.else},a.links.plugins.else,"block","blocks",f.block,
f.plugins.else,{order:"1"},d.id);c.scope.resourceLink(function(){return a.blocks.then},a.links.blocks.then,"block","blocks",f.block,f.blocks.then,{order:"1"},d.id);c.scope.resourceLink(function(){return a.blocks.else},a.links.blocks.else,"block","blocks",f.block,f.blocks.else,{order:"1"},d.id);a.test=function(b){void 0!=b&&void 0!=b.id&&""!=b.id&&f.block.task(b.id,"test",{},function(b){a.testExpression="true"==b},h.failure)};a.execute=function(c){void 0!=c&&void 0!=c.id&&""!=c.id&&f.block.task(c.id,
"execute",{},function(d){b.debug("[BLOCK/test]",c,d);a.testExpression=d},h.failure)};a.load=function(){a.activeTab=d.tab;e.scope.entity.get(d.id,function(b){a.block=b},f.block);a.plugins={if:{},then:{},else:{}};a.plugins.if=[];e.scope.collections.findAll("plugins.if",d.id,a.plugins.if,f.plugins.if);a.plugins.then=[];e.scope.collections.findAll("plugins.then",d.id,a.plugins.then,f.plugins.then);a.plugins.else=[];e.scope.collections.findAll("plugins.else",d.id,a.plugins.else,f.plugins.else);a.blocks=
{then:{},else:{}};a.blocks.then=[];e.scope.collections.findAll("blocks.then",d.id,a.blocks.then,f.blocks.then);a.blocks.else=[];e.scope.collections.findAll("blocks.else",d.id,a.blocks.else,f.blocks.else);b.debug("block-ctrl",a.scenario)}}]);"use strict";
angular.module("JarvisApp.ctrl.devices",["JarvisApp.services"]).controller("devicesCtrl",["$scope","$log","genericScopeService","deviceResourceService",function(a,b,d,c){d.scope.resources(function(b){a.devices=b},function(){return a.devices},a,"devices",c.device,{name:"object name",icon:"list"})}]).controller("deviceCtrl",["$scope","$log","$state","$stateParams","deviceResourceService","pluginResourceService","genericScopeService","genericResourceService","toastService",function(a,b,d,c,e,g,f,h,m){a.getLink=
function(){return a.plugins};f.scope.resource(a,"device","devices",e.device);a.links={plugins:{},triggers:{},devices:{}};f.scope.resourceLink(function(){return a.plugins},a.links.plugins,"device","devices",e.device,e.plugins,{order:"1"},c.id);f.scope.resourceLink(function(){return a.triggers},a.links.triggers,"device","devices",e.device,e.triggers,{order:"1"},c.id);f.scope.resourceLink(function(){return a.devices},a.links.devices,"device","devices",e.device,e.devices,{order:"1"},c.id);a.render=function(c){e.device.task(c.id,
"render",{},function(c){b.debug("deviceCtrl::render",c);a.renderdata=c;a.output=angular.toJson(c,!0)},m.failure)};a.load=function(){a.activeTab=c.tab;h.scope.entity.get(c.id,function(b){a.device=b},e.device);a.plugins=[];h.scope.collections.findAll("plugins",c.id,a.plugins,e.plugins);a.devices=[];h.scope.collections.findAll("devices",c.id,a.devices,e.devices);a.triggers=[];h.scope.collections.findAll("triggers",c.id,a.triggers,e.triggers);b.info("device-ctrl")}}]);"use strict";
angular.module("JarvisApp.ctrl.events",["JarvisApp.services"]).controller("eventsCtrl",["$scope","$log","genericScopeService","genericResourceService","eventResourceService",function(a,b,d,c,e){d.scope.resources(function(b){a.events=b},function(){return a.events},a,"events",e.event);a.crud=c.crud(["events"])}]);"use strict";
angular.module("JarvisApp.ctrl.triggers",["JarvisApp.services"]).controller("triggersCtrl",["$scope","$log","genericScopeService","triggerResourceService",function(a,b,d,c){d.scope.resources(function(b){a.triggers=b},function(){return a.triggers},a,"triggers",c.trigger,{name:"trigger name",icon:"settings_remote"})}]).controller("triggerCtrl",["$scope","$log","$stateParams","genericResourceService","genericScopeService","genericPickerService","triggerResourceService","toastService",function(a,b,d,
c,e,g,f,h){e.scope.resource(a,"trigger","triggers",f.trigger);a.links={crons:{}};e.scope.resourceLink(function(){return a.crons},a.links.crons,"cron","crons",f.trigger,f.crons,{order:"1"},d.id);a.load=function(){c.scope.entity.get(d.id,function(b){a.trigger=b},f.trigger);a.crons=[];c.scope.collections.findAll("crons",d.id,a.crons,f.crons);b.info("trigger-ctrl")}}]);"use strict";
angular.module("JarvisApp.ctrl.plugins",["JarvisApp.services"]).controller("pluginsCtrl",["$scope","$log","genericScopeService","pluginResourceService",function(a,b,d,c){d.scope.resources(function(b){a.plugins=b},function(){return a.plugins},a,"plugins/scripts",c.scripts,{name:"script name",icon:"list",type:"script"})}]).controller("pluginScriptCtrl",["$scope","$log","$stateParams","genericResourceService","genericScopeService","genericPickerService","pluginResourceService","deviceResourceService",
"jarvisWidgetCommandService","toastService",function(a,b,d,c,e,g,f,h,m,p){e.scope.resource(a,"script","plugins",f.scripts);a.links={commands:{}};e.scope.resourceLink(function(){return a.commands},a.links.commands,"script","plugins",f.scripts,f.commands,{order:"1",name:"noname",nature:"json",type:"data"},d.id);a.execute=function(c){void 0!=c&&void 0!=c.id&&""!=c.id&&f.scripts.task(c.id,"execute",a.rawTestData,function(d){b.debug("pluginScriptCtrl::execute",c,d);a.rawoutput=d;a.output=angular.toJson(d,
!0)},p.failure)};a.render=function(c){void 0!=c&&void 0!=c.id&&""!=c.id&&f.scripts.task(c.id,"render",a.rawTestData,function(d){b.debug("pluginScriptCtrl::render",c,d);a.rawoutput=d;a.output=angular.toJson(d,!0)},p.failure)};a.submit=function(){a.rawTestData=angular.fromJson(a.editTestData);a.jsonTestData=angular.toJson(a.rawTestData,!0)};a.clear=function(){a.rawoutput={};a.output=angular.toJson({},!0);a.rawTestData={};a.editTestData=angular.toJson(a.rawTestData,!0);a.jsonTestData=angular.toJson(a.rawTestData,
!0)};a.setOwner=function(c){b.debug("setOwner",c);a.script.owner=c.id};a.load=function(){a.activeTab=d.tab;a.clear();a.combo={booleans:[{id:!0,value:"True"},{id:!1,value:"False"}]};c.scope.entity.get(d.id,function(b){a.script=b},f.scripts);a.commands=[];c.scope.collections.findAll("commands",d.id,a.commands,f.commands);a.combo.owners=[{id:void 0,name:"device.empty"}];c.scope.combo.findAll("owner",a.combo.owners,h.device);b.info("script-ctrl")}}]);"use strict";
angular.module("JarvisApp.ctrl.views",["JarvisApp.services"]).controller("viewsCtrl",["$scope","$log","genericScopeService","viewResourceService",function(a,b,d,c){b.info("viewsCtrl");d.scope.resources(function(b){a.views=b},function(){return a.views},a,"views",c.view,{name:"view name",icon:"list"})}]).controller("viewCtrl",["$scope","$log","$stateParams","genericResourceService","genericScopeService","viewResourceService","deviceResourceService","toastService",function(a,b,d,c,e,g,f,h){e.scope.resource(a,
"view","views",g.view);a.links={devices:{}};e.scope.resourceLink(function(){return a.devices},a.links.devices,"view","views",g.view,g.devices,{order:"1"},d.id);a.load=function(){a.views=[];c.scope.entity.get(d.id,function(b){a.view=b},g.view);a.devices=[];c.scope.collections.findAll("devices",d.id,a.devices,g.devices);b.info("view-ctrl",a.views)}}]);"use strict";
angular.module("JarvisApp.ctrl.connectors",["JarvisApp.services"]).controller("connectorsCtrl",["$scope","$log","genericScopeService","connectorResourceService",function(a,b,d,c){d.scope.resources(function(b){a.connectors=b},function(){return a.connectors},a,"connectors",c.connector,{name:"connector name",icon:"settings_input_antenna",isRenderer:!1,isSensor:!1,canAnswer:!1})}]).controller("connectorCtrl",["$scope","$log","$stateParams","$mdDialog","genericResourceService","genericScopeService","connectorResourceService",
"toastService",function(a,b,d,c,e,g,f,h){g.scope.resource(a,"connector","connectors",f.connector);a.ping=function(b){f.connector.task(b.id,"ping",b,function(b){a.status=angular.toJson(b,!0)})};a.load=function(){e.scope.entity.get(d.id,function(b){a.connector=b},f.connector);b.info("connector-ctrl",a.connectors)}}]);"use strict";
angular.module("JarvisApp.ctrl.snapshots",["JarvisApp.services","JarvisApp.directives.files"]).controller("snapshotsCtrl",["$scope","$log","genericScopeService","snapshotResourceService",function(a,b,d,c){d.scope.resources(function(b){a.snapshots=b},function(){return a.snapshots},a,"snapshots",c.snapshot,{name:"snapshot name",icon:"list"})}]).controller("snapshotCtrl",["$scope","$log","$stateParams","$filter","$http","genericResourceService","genericScopeService","snapshotResourceService","deviceResourceService",
"toastService",function(a,b,d,c,e,g,f,h,m,p){f.scope.resource(a,"snapshot","snapshots",h.snapshot);a.restore=function(a){void 0!=a&&void 0!=a.id&&""!=a.id&&h.snapshot.task(a.id,"restore",{},function(c){b.debug("snapshotCtrl::restore",a,c)},p.failure)};a.download=function(a){void 0!=a&&void 0!=a.id&&""!=a.id&&h.snapshot.task(a.id,"download",{},function(d){var e="export-"+c("date")(new Date,"yyyyMMdd-HHmmss")+".json",f=document.createElement("a");document.body.appendChild(f);f.style="display: none";
b.debug("snapshot",a,d);d=new Blob([angular.toJson(d,!0)],{type:"application/text"});d=window.URL.createObjectURL(d);f.href=d;f.download=e;f.click()},p.failure)};a.upload=function(a){$("#"+a).trigger("click")};a.loaded=function(a,c){a.json=c.data;b.debug("loaded",a,c)};a.load=function(){a.snapshots=[];g.scope.entity.get(d.id,function(b){a.snapshot=b},h.snapshot);b.info("snapshot-ctrl",a.snapshots)}}]);"use strict";
angular.module("JarvisApp.ctrl.crons",["JarvisApp.services"]).controller("cronsCtrl",["$scope","$log","genericScopeService","cronResourceService","toastService",function(a,b,d,c,e){d.scope.resources(function(b){a.crons=b},function(){return a.crons},a,"crons",c.cron,{name:"cron name",icon:"list",cron:"* * * * *"});a.start=function(){_.each(a.crons,function(a){c.cron.task(a.id,"toggle",{target:!0},function(a){e.info("crontab "+crontab.name+"#"+crontab.id+" toggled to "+crontab.status)},e.failure)})};
a.stop=function(){_.each(a.crons,function(a){c.cron.task(a.id,"toggle",{target:!1},function(a){e.info("crontab "+crontab.name+"#"+crontab.id+" toggled to "+crontab.status)},e.failure)})}}]).controller("cronCtrl",["$scope","$log","$stateParams","$filter","$http","genericResourceService","genericScopeService","cronResourceService","deviceResourceService","toastService",function(a,b,d,c,e,g,f,h,m,p){f.scope.resource(a,"cron","crons",h.cron);a.toggle=function(a){b.info(a);h.cron.task(a.id,"toggle",{},
function(a){p.info("crontab "+crontab.name+"#"+crontab.id+" toggled to "+crontab.status)},p.failure)};a.test=function(a){b.info(a);h.cron.task(a.id,"test",{},function(a){p.info("crontab "+crontab.name+"#"+crontab.id+" toggled to "+crontab.status)},p.failure)};a.load=function(){a.crons=[];g.scope.entity.get(d.id,function(b){a.cron=b},h.cron);b.info("cron-ctrl",a.crons)}}]);"use strict";
angular.module("JarvisApp.ctrl.home",["JarvisApp.services"]).controller("homeCtrl",["$scope","$rootScope","$store","$log","viewResourceService","deviceResourceService","toastService","oauth2ResourceService",function(a,b,d,c,e,g,f,h){a.onSwipeLeft=function(){a.tabIndex>=a.views.length-1?a.tabIndex=a.views.length-1:a.tabIndex++};a.onSwipeRight=function(){0>=a.tabIndex?a.tabIndex=0:a.tabIndex--};a.selectTab=function(b,c){a.tabIndex=c};a.activeTab=function(b,c){return a.tabIndex==c};a.load=function(){a.store=
d;a.views=[];a.tabIndex=-1;e.view.findAll(function(b){var d=[];_.forEach(b,function(a){a.ishome&&(a.urlBackground="url('"+a.url+"')",d.push(a))});f.info(d.length+" view(s)");_.forEach(d,function(a){c.info("loading view",a);e.devices.findAll(a.id,function(b){a.devices=b;var d=_.after(a.devices.length,function(){c.debug("Linked devices to view",a.devices)});_.forEach(a.devices,function(a){g.device.task(a.id,"render",{},function(b){a.render=b;d(a)},f.failure)})},f.failure)});a.views=d;0<a.views.length&&
(a.tabIndex=0)},f.failure);c.info("home-ctrl")}}]).controller("helperCtrl",["$scope","$store","$log","viewResourceService","deviceResourceService","toastService",function(a,b,d,c,e,g){}]);"use strict";
angular.module("JarvisApp.ctrl.configurations",["JarvisApp.services"]).controller("configurationsCtrl",["$scope","$log","genericScopeService","configurationResourceService",function(a,b,d,c){d.scope.resources(function(b){a.configurations=b},function(){return a.configurations},a,"configurations",c.configuration,{name:"default",opacity:"1",backgroundUrl:"http://artroyalephotography.com/wp-content/uploads/2011/08/minimal-gray-to-white-gradient-wallpapers_33797_1920x1200-1024x640.jpg"})}]).controller("configurationCtrl",
["$scope","$log","$stateParams","$mdDialog","genericResourceService","genericScopeService","configurationResourceService","toastService",function(a,b,d,c,e,g,f,h){g.scope.resource(a,"configuration","configurations",f.configuration);a.load=function(){e.scope.entity.get(d.id,function(b){a.config=b},f.configuration);b.info("configuration-ctrl",a.configurations)}}]);"use strict";
angular.module("JarvisApp.ctrl.properties",["JarvisApp.services"]).controller("propertiesCtrl",["$scope","$log","genericScopeService","propertyResourceService",function(a,b,d,c){d.scope.resources(function(b){a.properties=b},function(){return a.properties},a,"properties",c.property,{key:"key",value:"value"})}]).controller("propertyCtrl",["$scope","$log","$stateParams","$mdDialog","genericResourceService","genericScopeService","propertyResourceService","toastService",function(a,b,d,c,e,g,f,h){g.scope.resource(a,
"property","properties",f.property);a.load=function(){e.scope.entity.get(d.id,function(b){a.property=b},f.property);b.info("property-ctrl",a.properties)}}]);"use strict";
angular.module("JarvisApp.ctrl.scenarios",["JarvisApp.services"]).controller("scenariosCtrl",["$scope","$log","genericScopeService","scenarioResourceService","toastService",function(a,b,d,c,e){d.scope.resources(function(b){a.scenarios=b},function(){return a.scenarios},a,"scenarios",c.scenario,{name:"scenario name",icon:"list"})}]).controller("scenarioCtrl",["$scope","$log","$stateParams","$mdDialog","genericScopeService","genericResourceService","genericPickerService","scenarioResourceService","blockResourceService",
"pluginResourceService","toastService",function(a,b,d,c,e,g,f,h,m,p,k){e.scope.resource(a,"scenario","scenarios",h.scenario);a.links={blocks:{},triggers:{}};e.scope.resourceLink(function(){return a.blocks},a.links.blocks,"scenario","scenarios",h.scenario,h.blocks,{order:"1"},d.id);e.scope.resourceLink(function(){return a.triggers},a.links.triggers,"scenario","scenarios",h.scenario,h.triggers,{order:"1"},d.id);a.build=function(a){var c=[];_.each(a,function(a){b.debug("graph",a.stage);var d="";_.each(a.nodes,
function(a){a.start&&(d+="#"+a.id+"\x3d\x3estart: "+a.name+":\x3e"+a.longId+"\n");a.end&&(d+="#"+a.id+"\x3d\x3eend: "+a.name+":\x3e"+a.longId+"\n");a.activity&&(d+="#"+a.id+"\x3d\x3eoperation: "+a.name+":\x3e"+a.longId+"\n");a.gateway&&(d+="#"+a.id+"\x3d\x3econdition: "+a.name+":\x3e"+a.longId+"\n");a.call&&(d+="#"+a.id+"\x3d\x3esubroutine: "+a.name+":\x3e"+a.longId+"\n")});_.each(a.edges,function(b){d=a.nodes[b.sourceId].gateway?b.bool?d+("#"+b.sourceId+"(yes, right)-\x3e#"+b.targetId+"\n"):d+("#"+
b.sourceId+"(no)-\x3e#"+b.targetId+"\n"):d+("#"+b.sourceId+"-\x3e#"+b.targetId+"\n")});c.push({stage:a.stage,code:d})});return c};a.render=function(a){b.debug(a);$("#canvas").html("");_.each(a,function(a){$("#canvas").append("\x3ch4\x3e"+a.stage+"\x3c/h4\x3e");$("#canvas").append('\x3cdiv id\x3d"canvas-'+a.stage+'"\x3e\x3c/div\x3e')});_.each(a,function(a){b.info("Render",a.stage);flowchart.parse(a.code).drawSVG("canvas-"+a.stage,{"line-width":3,"line-length":50,"text-margin":10,"font-size":12,font:"normal",
"font-family":"Helvetica","font-weight":"normal","font-color":"black","line-color":"black","element-color":"black",fill:"white","yes-text":"yes","no-text":"no","arrow-end":"block",scale:1,symbols:{start:{"font-color":"green","element-color":"green",fill:"yellow"},end:{"font-color":"red","element-color":"red",fill:"yellow"}},flowstate:{past:{fill:"#CCCCCC","font-size":12},current:{fill:"yellow","font-color":"red","font-weight":"bold"},future:{fill:"#FFFF99"},request:{fill:"blue"},invalid:{fill:"#444444"},
approved:{fill:"#58C4A3","font-size":12,"yes-text":"APPROVED","no-text":"n/a"},rejected:{fill:"#C45879","font-size":12,"yes-text":"n/a","no-text":"REJECTED"}}})})};a.chart=function(c){void 0!=c&&void 0!=c.id&&""!=c.id&&h.scenario.task(c.id,"render",{},function(d){b.debug("[SCENARIO/render]",c,d);a.codes=a.build(d);a.render(a.codes)},k.failure)};a.execute=function(c){void 0!=c&&void 0!=c.id&&""!=c.id&&h.scenario.task(c.id,"execute",{},function(d){b.debug("[SCENARIO/execute]",c,d);a.console=d},k.failure)};
a.load=function(){a.activeTab=d.tab;a.plugin={};g.scope.entity.get(d.id,function(b){a.scenario=b;a.chart(b)},h.scenario);a.blocks=[];g.scope.collections.findAll("blocks",d.id,a.blocks,h.blocks,function(a){_.forEach(a,function(a){a.plugins={};a.plugins.if=[];a.plugins.then=[];a.plugins.else=[];m.plugins.if.findAll(a.id,function(b){a.plugins.if=b});m.plugins.then.findAll(a.id,function(b){a.plugins.then=b});m.plugins.else.findAll(a.id,function(b){a.plugins.else=b});a.blocks={};a.blocks.then=[];a.blocks.else=
[];m.blocks.then.findAll(a.id,function(b){a.blocks.then=b});m.blocks.else.findAll(a.id,function(b){a.blocks.else=b});b.debug("blocks.plugins",a.plugins);b.debug("blocks.blocks",a.blocks)})});a.triggers=[];g.scope.collections.findAll("triggers",d.id,a.triggers,h.triggers);b.debug("scenario-ctrl",a.scenario)}}]);